<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ChatHistoryState">
    <option name="chatSessions" value="{&quot;13f3c2b9-c08d-4862-b452-a12fb8b57ec0&quot;:{&quot;id&quot;:&quot;13f3c2b9-c08d-4862-b452-a12fb8b57ec0&quot;,&quot;name&quot;:&quot;Cómo instalar todas las dependencias desde requirements.txt&quot;,&quot;timestamp&quot;:1763763070766,&quot;messages&quot;:[{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;text&quot;:&quot;\u003cuser_query\u003e\ncomo instalar todo la libreria de archivo requieremenrts.txt\n\u003c/user_query\u003e&quot;}]},{&quot;role&quot;:&quot;assistant&quot;,&quot;content&quot;:[]},{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;text&quot;:&quot;\u003cuser_query\u003e\ndsd\n\u003c/user_query\u003e&quot;}]},{&quot;role&quot;:&quot;assistant&quot;,&quot;content&quot;:[]}]},&quot;f4b70389-cf17-4d52-a4eb-f77aa4bf1c27&quot;:{&quot;id&quot;:&quot;f4b70389-cf17-4d52-a4eb-f77aa4bf1c27&quot;,&quot;name&quot;:&quot;Mostrar ID de usuario junto a datos personales al iniciar sesión&quot;,&quot;timestamp&quot;:1764602224876,&quot;messages&quot;:[{&quot;role&quot;:&quot;user&quot;,&quot;content&quot;:[{&quot;type&quot;:&quot;text&quot;,&quot;text&quot;:&quot;\n\u003cadditional_data\u003e\nBelow are some potentially helpful/relevant pieces of information for figuring out to respond\n\u003ccurrent_file\u003e\n```python:controllers/personal_controller.py, lines\u003dALL(1-143)\nfrom fastapi import APIRouter, HTTPException, BackgroundTasks\nfrom uuid import UUID\n\nfrom dto.personal_dto.personal_request_dto import PersonalCreateDTO\nfrom dto.personal_dto.personal_response_dto import PersonalResponseDTO\nfrom services.personal_service import PersonalService\n\nfrom pydantic import BaseModel, EmailStr, Field\n\n\nclass RecoverRequestDTO(BaseModel):\n    email: EmailStr\n    base_url: str\n\n\nclass ResetPasswordDTO(BaseModel):\n    password: str \u003d Field(..., min_length\u003d8)\n\n\nclass LoginRequestDTO(BaseModel):\n    email: EmailStr\n    password: str \u003d Field(..., min_length\u003d8)\n\n\nclass TokenResponseDTO(BaseModel):\n    access_token: str\n    token_type: str \u003d \&quot;bearer\&quot;\n\n\nrouter \u003d APIRouter(prefix\u003d\&quot;/personal\&quot;, tags\u003d[\&quot;Personal\&quot;])\n\n\n# -------------------------------------------------\n#   CREAR PERSONAL\n# -------------------------------------------------\n@router.post(\&quot;/\&quot;, response_model\u003dPersonalResponseDTO, status_code\u003d201)\nasync def crear_personal(data: PersonalCreateDTO):\n    \&quot;\&quot;\&quot;\n    Crea un nuevo personal.\n    El password llega en texto plano y se hashea en el servicio.\n    \&quot;\&quot;\&quot;\n    result \u003d await PersonalService.create(data)\n\n    if not result:\n        raise HTTPException(status_code\u003d400, detail\u003d\&quot;No se pudo crear el personal\&quot;)\n\n    # Normalizar sin exponer información sensible\n    try:\n        return PersonalResponseDTO.model_validate(result)\n    except Exception:\n        # Fallback manual si faltan claves\n        filtered \u003d {\n            k: result[k] for k in (\n                \&quot;id\&quot;, \&quot;dni\&quot;, \&quot;nombre\&quot;, \&quot;apellido_paterno\&quot;, \&quot;apellido_materno\&quot;,\n                \&quot;email\&quot;, \&quot;es_administrador\&quot;, \&quot;codificacion_facial\&quot;\n            ) if k in result\n        }\n        return filtered\n\n\n# -------------------------------------------------\n#   LOGIN\n# -------------------------------------------------\n@router.post(\&quot;/login\&quot;, response_model\u003dTokenResponseDTO)\nasync def login(data: LoginRequestDTO):\n    token \u003d await PersonalService.authenticate(str(data.email), data.password)\n\n    if not token:\n        raise HTTPException(status_code\u003d401, detail\u003d\&quot;Credenciales inválidas\&quot;)\n\n    return TokenResponseDTO(access_token\u003dtoken)\n\n\n# -------------------------------------------------\n#   LISTAR PERSONAL\n# -------------------------------------------------\n@router.get(\&quot;/\&quot;, response_model\u003dlist[PersonalResponseDTO])\nasync def listar_personal():\n    result \u003d await PersonalService.list_all()\n\n    # Evitar que Supabase devuelva password_hash\n    cleaned \u003d [\n        {k: row[k] for k in (\n            \&quot;id\&quot;, \&quot;dni\&quot;, \&quot;nombre\&quot;, \&quot;apellido_paterno\&quot;, \&quot;apellido_materno\&quot;,\n            \&quot;email\&quot;, \&quot;es_administrador\&quot;, \&quot;codificacion_facial\&quot;\n        ) if k in row}\n        for row in result\n    ]\n\n    return cleaned\n\n\n# -------------------------------------------------\n#   OBTENER POR ID\n# -------------------------------------------------\n@router.get(\&quot;/{personal_id}\&quot;, response_model\u003dPersonalResponseDTO)\nasync def obtener_por_id(personal_id: UUID):\n    result \u003d await PersonalService.get_by_id(personal_id)\n\n    if not result:\n        raise HTTPException(status_code\u003d404, detail\u003d\&quot;Personal no encontrado\&quot;)\n\n    return result\n\n\n# -------------------------------------------------\n#   ELIMINAR\n# -------------------------------------------------\n@router.delete(\&quot;/{personal_id}\&quot;)\nasync def eliminar_personal(personal_id: UUID):\n    await PersonalService.delete(personal_id)\n    return {\&quot;message\&quot;: \&quot;Personal eliminado correctamente\&quot;}\n\n\n# -------------------------------------------------\n#   RECUPERAR CONTRASEÑA (REQUEST TOKEN)\n# -------------------------------------------------\n@router.post(\&quot;/forgot-password\&quot;)\nasync def forgot_password(data: RecoverRequestDTO, background_tasks: BackgroundTasks):\n    # Ejecutar en background para no bloquear el request\n    background_tasks.add_task(\n        PersonalService.create_password_reset,\n        str(data.email),\n        data.base_url\n    )\n\n    # Misma respuesta siempre → evita revelar si el email existe\n    return {\&quot;message\&quot;: \&quot;Si el email existe, recibirás instrucciones para recuperar la contraseña.\&quot;}\n\n\n# -------------------------------------------------\n#   RESET PASSWORD (USANDO TOKEN)\n# -------------------------------------------------\n@router.post(\&quot;/reset/{token}\&quot;)\nasync def reset_password(token: str, data: ResetPasswordDTO):\n    ok \u003d await PersonalService.reset_password(token, data.password)\n\n    if not ok:\n        raise HTTPException(status_code\u003d400, detail\u003d\&quot;Token inválido o expirado\&quot;)\n\n    return {\&quot;message\&quot;: \&quot;Contraseña restablecida correctamente\&quot;}\n\n\n```\n\u003c/current_file\u003e\n\u003c/additional_data\u003e\n\u003cuser_query\u003e\nal iniciar seccion tanbien debol ver id de uaurio junto a sus datos personales\n\u003c/user_query\u003e&quot;}]},{&quot;role&quot;:&quot;assistant&quot;,&quot;content&quot;:[]}]}}" />
  </component>
</project>